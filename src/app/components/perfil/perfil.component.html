<div class="perfil-wrapper">
  
  <div *ngIf="loading" class="loading-spinner">
    <h2>Cargando perfil...</h2>
  </div>

  <div *ngIf="!loading && usuario" class="card-perfil fade-in">
    <div class="card-header-bg"></div>

    <div class="card-content">
      
      <div class="img-container">
        <img *ngIf="!editando" 
             [src]="avatarUrl" 
             alt="Foto de perfil" 
             class="profile-pic"
             onerror="this.src='https://cdn-icons-png.flaticon.com/512/3135/3135715.png'">

        <div *ngIf="editando" class="img-edit-wrapper" (click)="fileInput.click()">
          <img [src]="previewUrl || avatarUrl" class="profile-pic edit-mode">
          <div class="overlay-icon">ğŸ“·</div>
          <input #fileInput type="file" (change)="onFileSelected($event)" style="display: none" accept="image/*">
        </div>
      </div>

      <div class="text-center mt-3">
        
        <div *ngIf="!editando">
            <h2 class="user-name">{{ usuario.nombre }}</h2>
        </div>

        <div *ngIf="editando" class="edit-field-container">
            
            <label class="edit-label">Nombre:</label>
            <input type="text" [(ngModel)]="usuarioEdit.nombre" class="form-control-dark" placeholder="Tu nombre">
            
            <div *ngIf="!usuario.esGoogle" class="password-section">
                <p class="section-title">Cambiar ContraseÃ±a</p>

                <div class="mb-2">
                    <label class="edit-label">ContraseÃ±a Actual:</label>
                    <input type="password" 
                           [(ngModel)]="passwordActual" 
                           class="form-control-dark" 
                           placeholder="Requerida para guardar cambios">
                </div>

                <div>
                    <label class="edit-label">Nueva ContraseÃ±a:</label>
                    <input type="password" 
                           [(ngModel)]="passwordNueva" 
                           class="form-control-dark" 
                           placeholder="Opcional: Dejar vacÃ­o si no cambia">
                </div>
            </div>

        </div>

        <span class="badge-rol" [ngClass]="{
          'rol-alumno': usuario.rol === 'alumno',
          'rol-admin': usuario.rol === 'admin' || usuario.rol === 'maestro'
        }">{{ usuario.rol | uppercase }}</span>
      </div>

      <hr class="divider">

      <div class="action-buttons" *ngIf="!editando">
        <button class="btn-action btn-edit" (click)="activarEdicion()">
           âœï¸ Editar Perfil
        </button>
        <button class="btn-action btn-delete" (click)="eliminarCuenta()">
           ğŸ—‘ï¸ Eliminar Cuenta
        </button>
      </div>

      <div class="action-buttons" *ngIf="editando">
        <button class="btn-action btn-save" (click)="guardarCambios()">
           ğŸ’¾ Guardar
        </button>
        <button class="btn-action btn-cancel" (click)="cancelarEdicion()">
           âŒ Cancelar
        </button>
      </div>

      <div class="details-list mt-4">
        
        <div class="detail-item">
          <div class="icon">âœ‰ï¸</div>
          <div class="info">
            <small>Correo ElectrÃ³nico</small>
            <p>{{ usuario.correo }} 
              <span *ngIf="usuario.correoValidado" class="check-verified" title="Verificado">âœ”</span>
            </p>
          </div>
        </div>

        <div class="detail-item">
          <div class="icon">ğŸ“</div>
          <div class="info">
            <small>{{ usuario.idCarrera ? 'Carrera' : 'Departamento' }}</small>
            <p>{{ nombreEntidadAcademica }}</p>
          </div>
        </div>

        <div class="detail-item">
          <div class="icon">ğŸ”</div>
          <div class="info">
            <small>Tipo de Acceso</small>
            <p>
              {{ usuario.esGoogle ? 'Google Account' : 'Credenciales UAA' }}
            </p>
          </div>
        </div>

      </div>

    </div>
  </div>

  <div class="muro-container fade-in" *ngIf="usuario">
    <h3 class="muro-titulo">Publicaciones</h3>
    
    <div *ngIf="loadingPosts" class="text-center py-3" style="color:white;">
        Cargando actividad...
    </div>
    
    <div *ngIf="!loadingPosts && misPublicaciones.length > 0; else noPosts">
      <div class="post-wrapper" *ngFor="let post of misPublicaciones">
        <app-post-card [post]="post"></app-post-card>
      </div>
    </div>
    
    <ng-template #noPosts>
      <div class="empty-state" *ngIf="!loadingPosts">
        <p>AÃºn no has realizado ninguna publicaciÃ³n.</p>
      </div>
    </ng-template>
  </div>

  <div *ngIf="!loading && !usuario" class="alert-error">
    <p>âš ï¸ No se ha iniciado sesiÃ³n.</p>
  </div>

</div>