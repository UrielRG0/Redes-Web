<div class="post-card">
    
    <div class="post-header">
        <img class="avatar" [src]="avatarUrl" alt="Avatar">
        <div class="userInfo">
            <h4 class="author-name">
                {{ nombreAutor }}
                <span *ngIf="nombreEvento" class="event-connection">
                    <span class="separator">â–¶</span> 
                    <span class="event-name">{{ nombreEvento }}</span>
                    <span *ngIf="esEventoVerificado" class="verified-badge" title="Evento Oficial">
                          â˜‘
                    </span>
                </span>
            </h4>
            <div class="post-meta">
                <small>{{ post.createdAt | date: 'mediumDate' }}</small>
                <span class="dot">Â·</span>
            </div>
        </div>
        <div class="post-menu">...</div>
    </div>

    <div class="post-body">
        <h5 class="post-title">{{post.titulo}}</h5>
        <p class="post-text">
            {{ post.description }}
            <span class="hashtags-container" *ngIf="nombresIntereses.length > 0">
                <br><br> <span class="hashtag" *ngFor="let tag of nombresIntereses">#{{ tag }}</span>
            </span>
        </p>
        <div *ngIf="post.imagePaths && post.imagePaths.length > 0" class="media-container">
            <img *ngFor="let img of post.imagePaths" class="post-image" [src]="getPostImageUrl(img)">
        </div>
    </div>

    <div class="post-footer">
        <div class="actions-row">
            <button class="action-btn" (click)="toggleComentarios()">
                <span>ðŸ’¬</span> Comentar
            </button>
        </div>
    </div>
    <div class="comments-section" *ngIf="mostrarComentarios">
        <hr class="divider">
        
        <div class="comments-list">
             <div *ngIf="comentariosEstructurados.length === 0" class="text-center text-muted my-3">
                 <small>SÃ© el primero en comentar.</small>
             </div>

             <div class="comment-thread" *ngFor="let padre of comentariosEstructurados">
                 <div class="comment-item parent">
                    <img [src]="padre.fotoUsuarioUrl || 'assets/person.png'" class="comment-avatar">
                    <div class="comment-content">
                        <div class="comment-bubble">
                            <span class="comment-author">{{ padre.nombreUsuario }}</span>
                            <p class="comment-text">{{ padre.descripcion }}</p>
                        </div>
                        <div class="comment-actions">
                            <small>{{ padre.fechaComentario | date:'shortTime' }}</small>
                            <button class="btn-reply" (click)="activarResponder(padre.idComentario)">Responder</button>
                        </div>
                    </div>
                </div>

                <div class="replies-container" *ngIf="padre.respuestas && padre.respuestas.length > 0">
                    <div class="comment-item reply" *ngFor="let hijo of padre.respuestas">
                        <img [src]="hijo.fotoUsuarioUrl || 'assets/person.png'" class="comment-avatar small">
                        <div class="comment-content">
                            <div class="comment-bubble">
                                <span class="comment-author">{{ hijo.nombreUsuario }}</span>
                                <p class="comment-text">{{ hijo.descripcion }}</p>
                            </div>
                            <small class="text-muted ms-2">{{ hijo.fechaComentario | date:'shortTime' }}</small>
                        </div>
                    </div>
                </div>

                <div class="reply-input-box" *ngIf="idComentarioEnRespuesta === padre.idComentario">
                    <img [src]="avatarUrl || 'assets/person.png'" class="reply-avatar">
                    <div class="input-wrapper small-input">
                        <input type="text" [(ngModel)]="textoRespuesta" 
                               placeholder="Respondiendo..." 
                               (keyup.enter)="enviarRespuesta(padre.idComentario)">
                        <button class="send-btn" (click)="enviarRespuesta(padre.idComentario)">âž¤</button>
                    </div>
                </div>
             </div>
        </div>

        <div class="write-comment mt-3">
             <img [src]="avatarUrl || 'assets/person.png'" class="write-avatar">
             <div class="input-wrapper">
                 <input type="text" placeholder="Escribe un comentario..." 
                        [(ngModel)]="nuevoComentarioTexto"
                        (keyup.enter)="enviarComentario()">
                 <button class="send-btn" (click)="enviarComentario()">âž¤</button>
             </div>
        </div>

    </div>
</div>